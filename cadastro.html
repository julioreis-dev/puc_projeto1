<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="./img/assets/favicon.ico">   
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <!-- <script src="mock_database.js"></script> -->
    <script src="mock.json"></script>
    <title>BabyLogo-Cadastro</title>
</head>
<body onload="init()"> 
    
    <div class="row d-flex justify-content-center logo">
        <img src="./img/índice-removebg-preview.png" alt="logo">        
    </div>
    <div class="container">
        <!-- Navbar -->
        <div class="row">
            <a href="/" class="col-sm-2 offset-1 text-secondary" role="button">Home</a>
            <a href="cadastro.html" class="col-sm-2 offset-1 text-secondary" role="button">Cadastro</a>
            <a href="catalogo.html" class="col-sm-2 offset-1 text-secondary" role="button">Catálogo</a>
            <a href="/team.html" class="col-sm-2  offset-1 text-secondary" role="button">Quem Somos</a>
        </div>
        <hr>      
        <!-- block content -->
        
        <!-- first carousel -->
        <form id="form-contato">
            <div class="form-group">              
                <label for="inputId">Id</label>
                <input type="text" class="form-control" id="inputId" placeholder="ID" disabled>              
            </div>
            <div class="form-group">
              <label for="exampleFormControlInput1">Nome *</label>
              <input type="text" class="form-control" id="inputNome" required placeholder="Digite aqui seu nome">
            </div>
            <div class="form-group">
                <label for="exampleFormControlInput2">Sobrenome *</label>
                <input type="text" class="form-control" id="inputSobrenome" required placeholder="Digite aqui seu sobrenome">
            </div>
            <div class="form-group">
              <label for="exampleFormControlInput3">Email *</label>
              <input type="email" class="form-control" id="inputEmail" required placeholder="Informe o seu telefone">
            </div>
            <div class="form-group">
              <label for="exampleFormControlInput4">Nome do Produto *</label>
              <input type="text" class="form-control" id="inputNomeprod" required placeholder="Digite aqui o nome do produto">
            </div>
            <div class="form-group">
              <label for="exampleFormControlInput5">Preço do Produto *</label>
              <input type="text" class="form-control" id="inputPrecoprod" required placeholder="Especifique o preço que deseja vender o produto">
            </div>
            <div class="form-group">
              <label for="exampleFormControlTextarea6">Descrição do Produto:</label>
              <textarea class="form-control" id="inputDescricao" rows="7"></textarea>
            </div>
            <div class="col-sm-12">
              <input type="button" class="btn btn-success" id="btnInsert" value="Inserir" onclick="insertdata()" />
              <input type="button" class="btn btn-warning" id="btnUpdate" value="Alterar" onclick="updatedata()" />
              <input type="button" class="btn btn-danger" id="btnDelete" value="Excluir">
              <input type="button" class="btn btn-secondary" id="btnClear" value="Limpar Dados" onclick="cleardata()">
            </div>           
          </form>            
    </div>
    
    <div class="container">
      <div class="row p-4 justify-content-center">
        <h1>Produtos Cadastrados</h1>
      </div>      
      <div class="row d-flex justify-content-center">
        <div id="lista-produtos">
        <div class="row">
          <div class="col-sm-12">
              <table id="grid-contatos" class="table table-hover">
                  <thead>
                      <tr>
                          <th scope="col">ID</th>
                          <th scope="col">Nome</th>
                          <th scope="col">Sobrenome</th>
                          <th scope="col">Email</th>
                          <th scope="col">Produto</th>
                          <th scope="col">Preço (R$)</th>
                          <th scope="col">Descrição</th>
                      </tr>
                  </thead>
                  <tbody id="table-contatos">
                      <tr>
                          
                      </tr>
                  </tbody>
              </table>
          </div>
        </div>
      </div>
      </div>
    </div>
    
    <!-- Modal1 -->
    <div class="modal fade" id="ModalCentralizado" tabindex="-1" role="dialog" aria-labelledby="TituloModalCentralizado" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
          <div class="modal-header">
          <h5 class="modal-title" id="TituloModalCentralizado">Atenção</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
              <span aria-hidden="true">&times;</span>
          </button>
          </div>
          <div class="modal-body">
            Por favor, preencha todos os campos do formulário corretamente!!!
          </div>
          <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>          
          </div>
      </div>
      </div>
    </div>

    <!-- Modal2 -->
    <div class="modal fade" id="ModalCentralizado2" tabindex="-1" role="dialog" aria-labelledby="TituloModalCentralizado" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
          <div class="modal-header">
          <h5 class="modal-title" id="TituloModalCentralizado">Atenção</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
              <span aria-hidden="true">&times;</span>
          </button>
          </div>
          <div class="modal-body">
            Produto cadastrado corretamente!!!
          </div>
          <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>          
          </div>
      </div>
      </div>
    </div>
    



    <!-- endblock content -->

    <footer>
        <div class="row d-flex justify-content-center">
            <div class="col-sm-2">
                <a href=""><img src="./img/facebook.png" alt="facebook"></a>
                <a href=""><img src="./img/twitter.png" alt="twiter"></a>
                <a href=""><img src="./img/github.png" alt="github"></a>
            </div>
            <div class="col-sm-6 offset-0">
                <small>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Non, vitae!</small>                
                <small>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Beatae, temporibus!</small>
            </div>
            <div class="col-sm-2">
                <div>
                    <a class="link-light small text-secondary" href="#!">Privacy</a>
                    <span class="text-white mx-1">&middot;</span>
                    <a class="link-light small text-secondary" href="#!">Terms</a>
                    <span class="text-white mx-1">&middot;</span>
                    <a class="link-light small text-secondary" href="#!">Contact</a>
                </div>
            </div>            
            <div>
                <br>
                <small class="text-secondary">Copyright &copy; <script>document.write(new Date().getFullYear())</script>. Designed &amp; Developed by <a href="https://github.com/julioreis-dev/puc_projeto1">GRUPO 3</a></small class="text-secondary">
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script> -->
    <script src="mock_database.js"></script>
    <script>

    var prods = '';
    for (let i=0; i < db.dados.length; i++){
      let info = db.dados[i];
      $("#table-contatos").append(`<tr>
                                    <td scope="row">${info.id}</td>
                                    <td>${info.nome}</td>
                                    <td>${info.sobrenome}</td>
                                    <td>${info.email}</td>
                                    <td>${info.nomeprod}</td>
                                    <td>${info.precoprod}</td>
                                    <td>${info.descricao}</td>
                                  </tr>`);                    
    };   

    function abreModal(opt) {
      if (opt === 1){
        $("#ModalCentralizado").modal(
          {
          show: true          
          }
        );        
      }
      else{
        $("#ModalCentralizado2").modal({
          show: true
        })
      };
    }

      function insertdata(){
        console.log($("#form-contato")[0].checkValidity())
        let novoid = Math.floor(Math.random() * 9999);
        console.log(novoid)       
        if ($("#form-contato")[0].checkValidity()){                              
            let nome = $('#inputNome').val();
            let sobrenome = $('#inputSobrenome').val();
            let email = $('#inputEmail').val();
            let nomeprod = $('#inputNomeprod').val();
            let precoprod = $('#inputPrecoprod').val();
            let descricao = $('#inputDescricao').val();
            console.log(nome);
            
            let filedata = {
            "id":novoid,
            "nome":nome,
            "sobrenome": sobrenome,
            "email": email,
            "nomeprod": nomeprod,
            "image": "http://lorempixel.com.br/200/120/food/1",
            "precoprod": precoprod,
            "descricao": descricao
          }
          db.dados.push(filedata);
          localStorage.setItem('db_contato', JSON.stringify(db));
          console.log(db.dados);
          $("#form-contato")[0].reset();
          abreModal(2);
          // alert("Produto cadastrado corretamente!!!");
        }
        else{
          console.log(novoid)
          abreModal(1);
          // setTimeout(abreModal, 1000);

          // alert("Por favor, preencha todos os campos do formulário corretamente!!!");
        }
          return;
      };

      function cleardata(){
        $("#form-contato")[0].reset();
      };
      
      function updatedata(){
        let campoId = $("#inputId").val();
        console.log(campoId)
        if (db.dados.id == "") {
            displayMessage("Selecione um contato para ser alterado.");
            return;
        }
        let nome = $('#inputNome').val();
        let sobrenome = $('#inputSobrenome').val();
        let email = $('#inputEmail').val();
        let nomeprod = $('#inputNomeprod').val();
        let precoprod = $('#inputPrecoprod').val();
        let descricao = $('#inputDescricao').val();
        let contato = {
            "id":campoId,
            "nome":nome,
            "sobrenome": sobrenome,
            "email": email,
            "nomeprod": nomeprod,
            "image": "http://lorempixel.com.br/200/120/food/1",
            "precoprod": precoprod,
            "descricao": descricao
        };

        updateContato(parseInt(campoId), contato);

      };

      function init(){
        $("#grid-contatos").on("click", "tr", function (e) {
            let linhaContato = this;
            colunas = linhaContato.querySelectorAll("td");

            $("#inputId").val(colunas[0].innerText);
            $("#inputNome").val(colunas[1].innerText);
            $("#inputSobrenome").val(colunas[2].innerText);
            $("#inputEmail").val(colunas[3].innerText);
            $("#inputNomeprod").val(colunas[4].innerText);
            $("#inputPrecoprod").val(colunas[5].innerText);
            $("#inputDescricao").val(colunas[6].innerText);
        });
      
      function updateContato(id, contato) {
        // Localiza o indice do objeto a ser alterado no array a partir do seu ID
        let index = db.data.map(obj => obj.id).indexOf(id);

        // Altera os dados do objeto no array
        db.data[index].nome = contato.nome,
        db.data[index].sobrenome = contato.sobrenome,
        db.data[index].email = contato.email,
        db.data[index].nomeprod = contato.nomeprod,
        db.data[index].precoprod = contato.precoprod,
        db.data[index].descricao = contato.descricao        

        displayMessage("Contato alterado com sucesso");

        // Atualiza os dados no Local Storage
        localStorage.setItem('db_contato', JSON.stringify(db));
    };

    $("#btnDelete").click(function () {
        let campoId = $("#inputId").val();
        if (campoId == "") {
            alert("Selecione um contato a ser excluído.");
            return;
        }
        deleteContato(parseInt(campoId));

        // Reexibe os contatos
        // exibeContatos();

        // Limpa o formulario
        $("#form-contato")[0].reset();
    });

    function deleteContato(id) {    
        // Filtra o array removendo o elemento com o id passado
        db.dados = db.dados.filter(function (element) { return element.id != id });

        alert("Contato removido com sucesso");

        // Atualiza os dados no Local Storage
        localStorage.setItem('db_contato', JSON.stringify(db));
    }
      
      }
    </script>
</body>
</html>